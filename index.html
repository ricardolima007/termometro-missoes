<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Campanha de Missões Nacionais 2025 -IBCM</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>

<style>
:root{ --azul:#1E90FF; --sombra:rgba(0,0,0,0.25);}
html,body{ margin:0; padding:0; height:100%; font-family:Arial; overflow:hidden;}
#config{ height:100%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#fff,#f0f3f7); padding:20px;}
.card{ width:clamp(300px,90vw,680px); background:#fff; border-radius:16px; box-shadow:0 10px 30px var(--sombra); padding:22px;}
.grid{ display:grid; gap:12px; grid-template-columns:1fr 1fr;}
.grid>.full{ grid-column:1/-1;}
label{ font-size:14px; color:#333; margin-bottom:6px; display:block;}
input[type="text"],input[type="number"],select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d7dbe0; font-size:16px;}
input[type="color"]{ width:100%; height:42px; border:none; border-radius:10px; box-shadow: inset 0 0 0 1px #d7dbe0;}
input[type="file"]{ width:100%;}
.actions{ display:flex; gap:12px; justify-content:flex-end; margin-top:14px;}
button{ padding:12px 18px; border:none; border-radius:10px; font-size:16px; cursor:pointer;}
.primary{ background:var(--azul); color:#fff;}
.ghost{ background:#eef4ff; color:#0b3d91;}
#termometroPagina{ display:none; width:100%; height:100%; position:relative; background-position:center center; background-repeat:no-repeat; background-size:cover;}
#temaTitulo{ position:absolute; top:20px; left:50%; transform:translateX(-50%); padding:8px 14px; border-radius:10px; background:rgba(255,255,255,0.75); font-weight:700; box-shadow:0 4px 12px var(--sombra); max-width:90%; text-align:center;}
#termometroWrapper{ position:absolute; left:50%; bottom:64px; transform:translateX(-50%); width:min(95vw,980px); text-align:center;}
#termometroContainer{ position:relative; width:100%; height:64px; border-radius:40px; overflow:hidden; border:3px solid #3d3d3d; background:linear-gradient(90deg,#eee,#ddd); box-shadow:inset 0 2px 8px rgba(0,0,0,0.15),0 6px 18px var(--sombra);}
#preenchimento{ position:absolute; left:0; top:0; height:100%; width:0; border-radius:40px 0 0 40px; background:linear-gradient(90deg,var(--azul),#00CED1); background-size:200% 100%; animation:onda 2s linear infinite; box-shadow: inset 0 0 18px rgba(0,0,0,0.25);}
@keyframes onda{ from{background-position:0 0;} to{background-position:200% 0;} }
#bolinha{ position:absolute; top:50%; left:0; transform:translate(-50%,-50%); width:28px; height:28px; border-radius:50%; background: radial-gradient(circle,#FFD700 15%,#FFA500 60%,#FF8C00 100%); box-shadow:0 0 10px rgba(0,0,0,0.35);}
#marcador{ position:absolute; top:-72px; left:0; transform:translateX(-50%);}
#marcador .seta{ width:0;height:0;border-left:22px solid transparent;border-right:22px solid transparent;border-bottom:36px solid var(--azul); animation:spin 1.4s linear infinite,glow 1s ease-in-out infinite alternate; filter: drop-shadow(0 0 6px rgba(30,144,255,0.85));}
@keyframes spin{ from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
@keyframes glow{ from{ filter:drop-shadow(0 0 4px #1E90FF);} to{ filter:drop-shadow(0 0 14px #00BFFF);} }
#label{ margin-top:18px; font-weight:700; font-size:22px; color:#222; text-shadow:1px 1px 2px #fff;}
#metaLabel{ position:absolute; right:12px; top:50%; transform:translateY(-50%); font-weight:700; font-size:16px; color:#8B0000; text-shadow:1px 1px 2px #fff;}
#exportGifBtn{ position:absolute; top:20px; right:20px; padding:10px 16px; border:none; border-radius:8px; background:#1E90FF; color:#fff; cursor:pointer; z-index:9999;}
#exportVideoBtn{ position:absolute; top:70px; right:20px; padding:10px 16px; border:none; border-radius:8px; background:#28a745; color:#fff; cursor:pointer; z-index:9999;}
@media(max-width:640px){
  #termometroContainer{ height:48px; border-radius:32px;}
  #bolinha{ width:22px; height:22px;}
  #marcador{ top:-58px;}
  #marcador .seta{ border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid var(--azul);}
  #label{ font-size:17px;}
  #metaLabel{ font-size:13px;}
  #temaTitulo{ font-size:16px;}
  #termometroWrapper{ bottom:48px; width:95vw;}
}
</style>
</head>
<body>

<section id="config">
<div class="card">
<h2>Configuração do Termômetro</h2>
<div class="grid">
<div class="full"><label>Tema</label><input id="temaInput" type="text" value="Campanha de Missoes Nacionais 2025"/></div>
<div><label>Valor atual (R$)</label><input id="valorInput" type="number" min="0" max="4500" step="0.01" value="0"/></div>
<div><label>Cor principal do líquido</label><input id="tuboCor" type="color" value="#1E90FF"/></div>
<div class="full"><label>Tipo de fundo</label><select id="tipoFundo"><option value="degrade" selected>Degradê</option><option value="imagem">Imagem</option></select></div>
<div id="blkDegrade1"><label>Cor 1</label><input id="gradA" type="color" value="#ffffff"/></div>
<div id="blkDegrade2"><label>Cor 2</label><input id="gradB" type="color" value="#e6f0ff"/></div>
<div class="full" id="blkDegradeDir"><label>Direção do degradê</label><select id="gradDir"><option value="to right">→</option><option value="to left">←</option><option value="to bottom" selected>↓</option><option value="to top">↑</option><option value="135deg">Diagonal 135°</option><option value="45deg">Diagonal 45°</option></select></div>
<div class="full hidden" id="blkImagem"><label>Fundo da página</label><input id="fundoPagina" type="file" accept="image/*"/></div>
</div>
<div class="actions"><button class="ghost" id="previewBtn">Pré-visualizar fundo</button><button class="primary" id="gerarBtn">Gerar Termômetro</button></div>
</div>
</section>

<section id="termometroPagina">
<div id="temaTitulo"></div>
<div id="termometroWrapper">
<div id="termometroContainer">
<div id="preenchimento"></div>
<div id="bolinha"></div>
<div id="marcador"><div class="seta"></div></div>
<div id="metaLabel">Meta: R$ 4.500,00</div>
</div>
<div id="label">R$ 0,00 (0%)</div>
</div>
<button id="exportGifBtn">Exportar GIF</button>
<button id="exportVideoBtn">Exportar MP4</button>
</section>

<script>
const MAX=4500; let fundoImagemDataURL=null;
const elConfig=document.getElementById('config');
const elTermo=document.getElementById('termometroPagina');
const elTemaTitulo=document.getElementById('temaTitulo');
const elValor=document.getElementById('valorInput');
const elTuboCor=document.getElementById('tuboCor');
const elTipoFundo=document.getElementById('tipoFundo');
const elGradA=document.getElementById('gradA');
const elGradB=document.getElementById('gradB');
const elGradDir=document.getElementById('gradDir');
const elBlkImg=document.getElementById('blkImagem');
const elBlkDeg1=document.getElementById('blkDegrade1');
const elBlkDeg2=document.getElementById('blkDegrade2');
const elBlkDegDir=document.getElementById('blkDegradeDir');
const elFile=document.getElementById('fundoPagina');
const elGerar=document.getElementById('gerarBtn');
const elPreview=document.getElementById('previewBtn');
const container=document.getElementById('termometroContainer');
const preench=document.getElementById('preenchimento');
const bolinha=document.getElementById('bolinha');
const marcador=document.getElementById('marcador');
const label=document.getElementById('label');
const exportBtn=document.getElementById('exportGifBtn');
const exportVideoBtn=document.getElementById('exportVideoBtn');

elTipoFundo.addEventListener('change',()=>{
  const isImg=elTipoFundo.value==='imagem';
  elBlkImg.classList.toggle('hidden',!isImg);
  elBlkDeg1.classList.toggle('hidden',isImg);
  elBlkDeg2.classList.toggle('hidden',isImg);
  elBlkDegDir.classList.toggle('hidden',isImg);
});
elFile.addEventListener('change',e=>{
  const f=e.target.files?.[0]; if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{fundoImagemDataURL=ev.target.result;}
  r.readAsDataURL(f);
});
elPreview.addEventListener('click',()=>{
  aplicarFundo(elTermo,true);
  elConfig.style.display='none';
  elTermo.style.display='block';
  setTimeout(()=>{elTermo.style.display='none'; elConfig.style.display='flex';},1200);
});
elGerar.addEventListener('click',gerar);

function gerar(){
  let valor=Number(elValor.value||0); if(valor<0) valor=0; if(valor>MAX) valor=MAX;
  const tema=document.getElementById('temaInput').value||'Meta Financeira';
  elTemaTitulo.textContent=tema;
  elConfig.style.display='none'; elTermo.style.display='block';
  aplicarFundo(elTermo,false);
  const prim=elTuboCor.value||'#1E90FF';
  const sec='#00CED1';
  preench.style.background=`linear-gradient(90deg,${prim},${sec})`;
  const W=container.clientWidth; const alvo=W*(valor/MAX);
  let t0;
  function animar(ts){
    if(!t0) t0=ts; const dt=ts-t0; const dur=1800;
    const p=Math.min(1,dt/dur); const ease=1-Math.pow(1-p,3);
    const x=alvo*ease;
    preench.style.width=x+'px';
    const valNow=valor*ease; const percNow=Math.round(valNow/MAX*100);
    label.textContent=`R$ ${valNow.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2})} (${percNow}%)`;
    const amp=Math.max(6,Math.min(12,container.clientHeight*0.15));
    const fase=dt*0.012; const yOffset=amp*Math.sin(fase);
    bolinha.style.left=x+'px'; bolinha.style.top=`calc(50% + ${yOffset}px)`;
    marcador.style.left=x+'px';
    if(p<1) requestAnimationFrame(animar);
    else iniciarLoopSeguimento(x);
  }
  requestAnimationFrame(animar);
}
function iniciarLoopSeguimento(xFinal){
  let t=0;
  function loop(){ t+=16;
    const amp=Math.max(6,Math.min(12,container.clientHeight*0.15));
    const yOffset=amp*Math.sin(t*0.012);
    bolinha.style.left=xFinal+'px';
    bolinha.style.top=`calc(50% + ${yOffset}px)`;
    marcador.style.left=xFinal+'px';
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
}
function aplicarFundo(target,isPreview){
  const tipo=elTipoFundo.value;
  if(tipo==='degrade'){
    const a=elGradA.value||'#ffffff'; const b=elGradB.value||'#e6f0ff'; const dir=elGradDir.value||'to bottom';
    target.style.backgroundImage=`linear-gradient(${dir},${a},${b})`; target.style.backgroundSize='cover';
  }else{
    if(!fundoImagemDataURL && !isPreview) target.style.backgroundImage='linear-gradient(180deg,#ffffff,#f3f6fa)';
    else if(fundoImagemDataURL) target.style.backgroundImage=`url('${fundoImagemDataURL}')`;
    target.style.backgroundSize='auto'; target.style.backgroundRepeat='no-repeat'; target.style.backgroundPosition='center center';
  }
}

// Exportar GIF
exportBtn.addEventListener('click',()=>{
  const termoWrapper=document.getElementById('termometroWrapper');
  const frames=40; const delay=50;
  const gif=new GIF({workers:2,quality:10,width:termoWrapper.offsetWidth,height:termoWrapper.offsetHeight});
  let frameCount=0;
  function captureFrame(){
    html2canvas(termoWrapper,{backgroundColor:null}).then(canvas=>{
      gif.addFrame(canvas,{delay:delay,copy:true});
      frameCount++;
      if(frameCount<frames) requestAnimationFrame(captureFrame);
      else{
        gif.on('finished', blob => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'termometro.gif';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });
        gif.render();
      }
    });
  }
  captureFrame();
});

// Exportar MP4/WebM
exportVideoBtn.addEventListener('click', async () => {
    const termoWrapper = document.getElementById('termometroWrapper');
    const valor = Number(elValor.value || 0);
    const duracaoAnimacao = 3000;
    const tempoVideo = duracaoAnimacao + 500;

    exportVideoBtn.textContent = 'Gravando...';
    exportVideoBtn.disabled = true;

    const stream = termoWrapper.captureStream(30);
    const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    const chunks = [];

    recorder.ondataavailable = e => { if(e.data.size>0) chunks.push(e.data); };
    recorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'termometro.webm';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        exportVideoBtn.textContent = 'Exportar MP4';
        exportVideoBtn.disabled = false;
    };

    recorder.start();
    gerar();
    setTimeout(() => { recorder.stop(); }, tempoVideo);
});
</script>
</body>
</html>
