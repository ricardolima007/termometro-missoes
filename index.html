<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Campanha de Missões Nacionais 2025 - IBCM</title>
<style>
  :root{
    --azul:#1E90FF;
    --sombra:rgba(0,0,0,0.25);
  }
  html, body {
    margin:0; padding:0; height:100%;
    font-family: Arial, sans-serif;
    background:#f5f5f5;
    overflow:hidden;
  }

  /* ===== TELA DE CONFIG ===== */
  #config{
    height:100%; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(135deg,#ffffff,#f0f3f7);
    padding:20px;
  }
  .card{
    width:clamp(300px, 90vw, 680px);
    background:#fff; border-radius:16px; box-shadow:0 10px 30px var(--sombra);
    padding:22px;
  }
  .grid{
    display:grid; gap:12px;
    grid-template-columns: 1fr 1fr;
  }
  .grid > .full { grid-column: 1 / -1; }
  label{ font-size:14px; color:#333; display:block; margin-bottom:6px; }
  input[type="text"], input[type="number"], select{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d7dbe0; font-size:16px;
  }
  input[type="color"]{ width:100%; height:42px; padding:0; border:none; background:#fff; border-radius:10px; box-shadow: inset 0 0 0 1px #d7dbe0; }
  input[type="file"]{ width:100%; }
  .row{ display:flex; gap:10px; align-items:center; }
  .actions{ display:flex; gap:12px; justify-content:flex-end; margin-top:14px; }
  button{
    padding:12px 18px; border:none; border-radius:10px; font-size:16px; cursor:pointer;
  }
  .primary{ background:var(--azul); color:#fff; }
  .ghost{ background:#eef4ff; color:#0b3d91; }
  .hint{ font-size:12px; color:#666; margin-top:4px; }

  /* Esconde/mostra blocos conforme tipo de fundo */
  .hidden{ display:none; }

  /* ===== TELA DO TERMÔMETRO ===== */
  #termometroPagina{
    display:none; width:100%; height:100%; position:relative;
    background-position:center center; background-repeat:no-repeat;
    /* para degradê, o background-image será um linear-gradient dinamicamente */
    background-size:auto; /* mantém imagem no tamanho original quando for imagem */
  }

  /* Título/tema no topo */
  #temaTitulo{
    position:absolute; top:20px; left:50%; transform:translateX(-50%);
    padding:8px 14px; border-radius:10px; background:rgba(255,255,255,0.75);
    font-weight:700; box-shadow:0 4px 12px var(--sombra);
    max-width:90%; text-align:center;
  }

  /* Wrapper do termômetro (centralizado na parte de baixo) */
  #termometroWrapper{
    position:absolute; left:50%; bottom:90px; transform:translateX(-50%);
    width:min(92vw, 980px); text-align:center;
  }

  /* Barra do termômetro */
  #termometroContainer{
    position:relative; width:100%; height:64px; border-radius:40px; overflow:hidden;
    border:3px solid #3d3d3d; background:linear-gradient(90deg,#eee,#ddd);
    box-shadow:inset 0 2px 8px rgba(0,0,0,0.15), 0 6px 18px var(--sombra);
  }

  /* Líquido com efeito de onda (animado via background-position) */
  #preenchimento{
    position:absolute; left:0; top:0; height:100%; width:0;
    border-radius:40px 0 0 40px;
    background:linear-gradient(90deg, var(--azul), #00CED1);
    background-size:200% 100%;
    animation:onda 2s linear infinite;
    box-shadow: inset 0 0 18px rgba(0,0,0,0.25);
  }
  @keyframes onda {
    from { background-position: 0% 0; }
    to   { background-position: 200% 0; }
  }

  /* Bolinha que "surfa" na frente do líquido (curva suave) */
  #bolinha{
    position:absolute; top:50%; left:0; transform:translate(-50%,-50%);
    width:28px; height:28px; border-radius:50%;
    background: radial-gradient(circle, #FFD700 15%, #FFA500 60%, #FF8C00 100%);
    box-shadow:0 0 10px rgba(0,0,0,0.35);
  }

  /* Marcador (posicionado na frente do líquido) */
  #marcador{
    position:absolute; top:-72px; left:0; transform:translateX(-50%);
    width:0; height:0;
  }
  /* Seta azul interna que gira e brilha em loop */
  #marcador .seta{
    width:0; height:0;
    border-left: 22px solid transparent;
    border-right:22px solid transparent;
    border-bottom:36px solid var(--azul);
    animation: spin 1.4s linear infinite, glow 1s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 6px rgba(30,144,255,0.85));
  }
  @keyframes spin { from { transform:rotate(0deg);} to{ transform:rotate(360deg);} }
  @keyframes glow { from { filter: drop-shadow(0 0 4px #1E90FF);} to{ filter: drop-shadow(0 0 14px #00BFFF);} }

  /* Rótulos */
  #label{
    margin-top:18px; font-weight:700; font-size:22px; color:#222;
    text-shadow:1px 1px 2px #fff;
  }
  #metaLabel{
    position:absolute; right:12px; top:50%; transform:translateY(-50%);
    font-weight:700; font-size:16px; color:#8B0000; text-shadow:1px 1px 2px #fff;
  }

  /* ===== Responsividade (celular) ===== */
  @media (max-width: 640px){
    .grid{ grid-template-columns:1fr; }
    #termometroWrapper{ bottom:64px; width:95vw; }
    #termometroContainer{ height:48px; border-radius:32px; }
    #bolinha{ width:22px; height:22px; }
    #marcador{ top:-58px; }
    #marcador .seta{
      border-left:18px solid transparent; border-right:18px solid transparent; border-bottom:28px solid var(--azul);
    }
    #label{ font-size:17px; }
    #metaLabel{ font-size:13px; }
    #temaTitulo{ font-size:16px; }
  }
</style>
</head>
<body>

<!-- ========== TELA DE CONFIGURAÇÃO ========== -->
<section id="config">
  <div class="card">
    <h2 style="margin-top:0">Configuração do Termômetro</h2>

    <div class="grid">
      <div class="full">
        <label for="temaInput">Tema</label>
        <input id="temaInput" type="text" placeholder="Ex.: Campanha de Doações" value="Campanha de Missões 2025" />
      </div>

      <div>
        <label for="valorInput">Valor atual (R$) — máx 4.500,00</label>
        <input id="valorInput" type="number" min="0" max="4500" step="0.01" value="0" />
      </div>

      <div>
        <label for="tuboCor">Cor principal do líquido</label>
        <input id="tuboCor" type="color" value="#1E90FF"/>
      </div>

      <div class="full">
        <label for="tipoFundo">Tipo de fundo</label>
        <select id="tipoFundo">
          <option value="degrade" selected>Degradê (duas cores)</option>
          <option value="imagem">Imagem (arquivo do PC)</option>
        </select>
      </div>

      <!-- Controles: DEGRADÊ -->
      <div id="blkDegrade1">
        <label for="gradA">Degradê - Cor 1</label>
        <input id="gradA" type="color" value="#ffffff"/>
      </div>
      <div id="blkDegrade2">
        <label for="gradB">Degradê - Cor 2</label>
        <input id="gradB" type="color" value="#e6f0ff"/>
      </div>
      <div class="full" id="blkDegradeDir">
        <label for="gradDir">Direção do degradê</label>
        <select id="gradDir">
          <option value="to right">→ Para a direita</option>
          <option value="to left">← Para a esquerda</option>
          <option value="to bottom" selected>↓ Para baixo</option>
          <option value="to top">↑ Para cima</option>
          <option value="135deg">Diagonal 135°</option>
          <option value="45deg">Diagonal 45°</option>
        </select>
        <div class="hint">Dica: combine cores claras para destacar o termômetro.</div>
      </div>

      <!-- Controles: IMAGEM -->
      <div class="full hidden" id="blkImagem">
        <label for="fundoPagina">Fundo da página (imagem)</label>
        <input id="fundoPagina" type="file" accept="image/*"/>
        <div class="hint">A imagem é exibida no tamanho original.</div>
      </div>
    </div>

    <div class="actions">
      <button class="ghost" type="button" id="previewBtn">Pré-visualizar fundo</button>
      <button class="primary" type="button" id="gerarBtn">Gerar Termômetro</button>
    </div>
  </div>
</section>

<!-- ========== TELA DO TERMÔMETRO ========== -->
<section id="termometroPagina">
  <div id="temaTitulo"></div>

  <div id="termometroWrapper">
    <div id="termometroContainer">
      <div id="preenchimento"></div>

      <!-- Bolinha e marcador/ seta (ficam presos à frente do preenchimento) -->
      <div id="bolinha"></div>
      <div id="marcador"><div class="seta"></div></div>

      <div id="metaLabel">Meta: R$ 4.500,00</div>
    </div>
    <div id="label">R$ 0,00 (0%)</div>
  </div>
</section>

<script>
  // ======= ESTADO =======
  const MAX = 4500;
  let fundoImagemDataURL = null;

  // ======= ELEMENTOS =======
  const elConfig = document.getElementById('config');
  const elTermo = document.getElementById('termometroPagina');
  const elTemaTitulo = document.getElementById('temaTitulo');

  const elValor = document.getElementById('valorInput');
  const elTuboCor = document.getElementById('tuboCor');

  const elTipoFundo = document.getElementById('tipoFundo');
  const elGradA = document.getElementById('gradA');
  const elGradB = document.getElementById('gradB');
  const elGradDir = document.getElementById('gradDir');
  const elBlkImg = document.getElementById('blkImagem');
  const elBlkDeg1 = document.getElementById('blkDegrade1');
  const elBlkDeg2 = document.getElementById('blkDegrade2');
  const elBlkDegDir = document.getElementById('blkDegradeDir');
  const elFile = document.getElementById('fundoPagina');

  const elGerar = document.getElementById('gerarBtn');
  const elPreview = document.getElementById('previewBtn');

  const container = document.getElementById('termometroContainer');
  const preench = document.getElementById('preenchimento');
  const bolinha = document.getElementById('bolinha');
  const marcador = document.getElementById('marcador');
  const label = document.getElementById('label');

  // ======= TROCA DE TIPO DE FUNDO =======
  elTipoFundo.addEventListener('change', () => {
    const isImg = elTipoFundo.value === 'imagem';
    elBlkImg.classList.toggle('hidden', !isImg);
    elBlkDeg1.classList.toggle('hidden', isImg);
    elBlkDeg2.classList.toggle('hidden', isImg);
    elBlkDegDir.classList.toggle('hidden', isImg);
  });

  // Ler imagem escolhida
  elFile.addEventListener('change', (e) => {
    const f = e.target.files?.[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = ev => { fundoImagemDataURL = ev.target.result; };
    r.readAsDataURL(f);
  });

  // Aplica fundo conforme configuração (sem sair da tela de config)
  elPreview.addEventListener('click', () => {
    aplicarFundo(elTermo, true); // só para prévia visual
    // Mostra rapidamente a tela de termômetro e volta (prévia)
    elConfig.style.display = 'none';
    elTermo.style.display = 'block';
    setTimeout(()=>{
      elTermo.style.display = 'none';
      elConfig.style.display = 'flex';
    }, 1200);
  });

  // ======= GERAR =======
  elGerar.addEventListener('click', gerar);

  function gerar(){
    // Sanitiza valor
    let valor = Number(elValor.value || 0);
    if (valor < 0) valor = 0;
    if (valor > MAX) valor = MAX;

    // Tema
    const tema = document.getElementById('temaInput').value || 'Meta Financeira';
    elTemaTitulo.textContent = tema;

    // Entra na tela do termômetro
    elConfig.style.display = 'none';
    elTermo.style.display = 'block';

    // Fundo
    aplicarFundo(elTermo, false);

    // Cores do líquido
    const prim = elTuboCor.value || '#1E90FF';
    const sec = '#00CED1';
    preench.style.background = `linear-gradient(90deg, ${prim}, ${sec})`;

    // Dimensões para animar
    const W = container.clientWidth;
    const alvo = W * (valor / MAX);

    // Animar preenchimento (tempo ~1.8s)
    let t0;
    function animar(ts){
      if(!t0) t0 = ts;
      const dt = ts - t0;
      const dur = 1800; // ms
      const p = Math.min(1, dt/dur);

      // easing suave (easeOutCubic)
      const ease = 1 - Math.pow(1 - p, 3);

      const x = alvo * ease; // largura atual do líquido
      preench.style.width = x + 'px';

      // contador de valor
      const valNow = valor * ease;
      const percNow = Math.round((valNow / MAX) * 100);
      label.textContent = `R$ ${valNow.toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2})} (${percNow}%)`;

      // posiciona bolinha e marcador na frente do líquido com curva (senoidal)
      const amp = Math.max(6, Math.min(12, container.clientHeight * 0.15));
      const fase = dt * 0.012; // velocidade da oscilação
      const yOffset = amp * Math.sin(fase); // curva suave

      bolinha.style.left = x + 'px';
      bolinha.style.top  = `calc(50% + ${yOffset}px)`;

      marcador.style.left = x + 'px';

      if(p < 1) requestAnimationFrame(animar);
      else iniciarLoopSeguimento(x); // depois que chega no alvo, mantém a vida da animação (onda/bolinha/seta)
    }
    requestAnimationFrame(animar);
  }

  // Mantém a bolinha “viva” após atingir o valor final (oscila em curva)
  function iniciarLoopSeguimento(xFinal){
    let t = 0;
    function loop(){
      t += 16; // aprox ms por frame
      const amp = Math.max(6, Math.min(12, container.clientHeight * 0.15));
      const yOffset = amp * Math.sin(t * 0.012);
      bolinha.style.left = xFinal + 'px';
      bolinha.style.top  = `calc(50% + ${yOffset}px)`;
      marcador.style.left = xFinal + 'px';
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  }

  // Aplica o fundo conforme escolha
  function aplicarFundo(target, isPreview){
    const tipo = elTipoFundo.value;
    if(tipo === 'degrade'){
      const a = elGradA.value || '#ffffff';
      const b = elGradB.value || '#e6f0ff';
      const dir = elGradDir.value || 'to bottom';
      target.style.backgroundImage = `linear-gradient(${dir}, ${a}, ${b})`;
      target.style.backgroundSize = 'cover'; // para degradê, tanto faz; cover preenche a tela suavemente
    }else{
      // imagem no tamanho original, centralizada
      if(!fundoImagemDataURL && !isPreview){
        // sem imagem selecionada, cai num fundo neutro
        target.style.backgroundImage = 'linear-gradient(180deg,#ffffff,#f3f6fa)';
      }else if(fundoImagemDataURL){
        target.style.backgroundImage = `url('${fundoImagemDataURL}')`;
        target.style.backgroundSize   = 'auto';       // tamanho original
        target.style.backgroundRepeat = 'no-repeat';
        target.style.backgroundPosition = 'center center';
      }
    }
  }
</script>
</body>
</html>

